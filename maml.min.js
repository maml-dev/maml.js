function m(o){if(typeof o!="string")throw TypeError("Source must be a string");let s=0,y=1,e,l=!1;r();let h=c();if(a(),!l)throw new SyntaxError(f());return E(h),h;function r(){s<o.length?(e=o[s],s++):(e="",l=!0),e===`
`&&y++}function u(){return o.substring(s,s+2)}function c(){return a(),O()??x()??k()??I()??J()??d("true",!0)??d("false",!1)??d("null",null)}function x(){if(e!=='"')return;let n="",t=!1;for(;;)if(r(),t){if(e==="u"){if(r(),e!=="{")throw new SyntaxError(f(S.u+" "+JSON.stringify(e)+' (expected "{")'));let i="";for(;r(),e!=="}";){if(!j(e))throw new SyntaxError(f(S.u+" "+JSON.stringify(e)));if(i+=e,i.length>6)throw new SyntaxError(f(S.u+" (too many hex digits)"))}if(i.length===0)throw new SyntaxError(f(S.u));let w=parseInt(i,16);if(w>1114111)throw new SyntaxError(f(S.u+" (out of range)"));n+=String.fromCodePoint(w)}else{let i=U[e];if(!i)throw new SyntaxError(f(S.u+" "+JSON.stringify(e)));n+=i}t=!1}else if(e==="\\")t=!0;else{if(e==='"')break;if(e===`
`)throw new SyntaxError(f('Use """ for multiline strings or escape newlines with "\\n"'));if(e<"")throw new SyntaxError(f(`Unescaped control character ${JSON.stringify(e)}`));n+=e}return r(),n}function O(){if(e!=='"'||u()!=='""')return;r(),r(),r();let n=!1;e===`
`&&(n=!0,r());let t="";for(;!l;){if(e==='"'&&u()==='""'){if(r(),r(),r(),t===""&&!n)throw new SyntaxError(f("Multiline strings cannot be empty"));return t}t+=e,r()}throw new SyntaxError(f())}function k(){if(!p(e)&&e!=="-")return;let n="",t=!1;if(e==="-"&&(n+=e,r(),!p(e)))throw new SyntaxError(f());if(e==="0")n+=e,r();else for(;p(e);)n+=e,r();if(e==="."){if(t=!0,n+=e,r(),!p(e))throw new SyntaxError(f());for(;p(e);)n+=e,r()}if(e==="e"||e==="E"){if(t=!0,n+=e,r(),(e==="+"||e==="-")&&(n+=e,r()),!p(e))throw new SyntaxError(f());for(;p(e);)n+=e,r()}return t?parseFloat(n):F(n)}function I(){if(e!=="{")return;r(),a();let n={};if(e==="}")return r(),n;for(;;){let t=s,i;if(e==='"'?i=x():i=M(),Object.prototype.hasOwnProperty.call(n,i))throw s=t,new SyntaxError(f(`Duplicate key ${JSON.stringify(i)}`));if(a(),e!==":")throw new SyntaxError(f());r();let w=c();E(w),n[i]=w;let b=a();if(e==="}")return r(),n;if(e===","){if(r(),a(),e==="}")return r(),n}else{if(b)continue;throw new SyntaxError(f("Expected comma or newline between key-value pairs"))}}}function M(){let n="";for(;C(e);)n+=e,r();if(n==="")throw new SyntaxError(f());return n}function J(){if(e!=="[")return;r(),a();let n=[];if(e==="]")return r(),n;for(;;){let t=c();E(t),n.push(t);let i=a();if(e==="]")return r(),n;if(e===","){if(r(),a(),e==="]")return r(),n}else{if(i)continue;throw new SyntaxError(f("Expected comma or newline between values"))}}}function d(n,t){if(e===n[0]){for(let i=1;i<n.length;i++)if(r(),e!==n[i])throw new SyntaxError(f());if(r(),$(e)||e===","||e==="}"||e==="]"||e===void 0)return t;throw new SyntaxError(f())}}function a(){let n=!1;for(;$(e);)n||=e===`
`,r();let t=_();return n||t}function _(){if(e==="#"){for(;!l&&e!==`
`;)r();return a()}return!1}function $(n){return n===" "||n===`
`||n==="	"||n==="\r"}function j(n){return n>="0"&&n<="9"||n>="A"&&n<="F"}function p(n){return n>="0"&&n<="9"}function C(n){return n>="A"&&n<="Z"||n>="a"&&n<="z"||n>="0"&&n<="9"||n==="_"||n==="-"}function F(n){if(n=="-0")return-0;let t=Number(n);return t>=Number.MIN_SAFE_INTEGER&&t<=Number.MAX_SAFE_INTEGER?t:BigInt(n)}function E(n){if(n===void 0)throw new SyntaxError(f())}function f(n=`Unexpected character ${JSON.stringify(e)}`){e||(n="Unexpected end of input");let t=o.substring(s-40,s).split(`
`),i=t.at(-1)||"",w=o.substring(s,s+40).split(`
`,1).at(0)||"";i===""&&(i=t.at(-2)||"",i+=" ",y--,w="");let b=`    ${i}${w}
`,K=`    ${".".repeat(Math.max(0,i.length-1))}^
`;return`${n} on line ${y}.

${b}${K}`}}var U={'"':'"',"\\":"\\",n:`
`,r:"\r",t:"	"},S={u:"Invalid escape sequence"};function A(o){return N(o,0)}function N(o,s){let y=o===null?"null":Array.isArray(o)?"array":typeof o;switch(y){case"string":return JSON.stringify(o);case"boolean":case"bigint":case"number":return`${o}`;case"null":case"undefined":return"null";case"array":{let e=o.length;if(e===0)return"[]";let l=g(s+1),h=g(s),r=`[
`;for(let u=0;u<e;u++)u>0&&(r+=`
`),r+=l+N(o[u],s+1);return r+`
`+h+"]"}case"object":{let e=Object.keys(o),l=e.length;if(l===0)return"{}";let h=g(s+1),r=g(s),u=`{
`;for(let c=0;c<l;c++){c>0&&(u+=`
`);let x=e[c];u+=h+P(x)+": "+N(o[x],s+1)}return u+`
`+r+"}"}default:throw new Error(`Unsupported value type: ${y}`)}}var L=/^[A-Za-z0-9_-]+$/;function P(o){return L.test(o)?o:JSON.stringify(o)}function g(o){return" ".repeat(2*o)}globalThis.MAML={parse:m,stringify:A};
